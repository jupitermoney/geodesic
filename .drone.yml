kind: pipeline
name: default

steps:
  - name: build-image
    image: docker:dind
    volumes:
      - name: dockersock
        path: /var/run
    environment:
      json_key:
        from_secret: gcr_json_key
    commands:
      - apk add --update make curl bash git
      - echo $json_key | docker login https://asia.gcr.io -u _json_key --password-stdin
      - make init
      - make lint
      - make packages/reinstall/shfmt
      - make bash/fmt/check
      - docker ps -a
#      - make docker/build
#      - make push

services:
  - name: docker
    image: docker:dind
    privileged: true
    volumes:
      - name: dockersock
        path: /var/run

volumes:
  - name: dockersock
    temp: {}