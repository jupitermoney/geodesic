kind: pipeline
name: default

steps:
  - name: build-image
    image: docker:dind
    volumes:
      - name: dockersock
        path: /var/run/docker.sock
    environment:
      json_key:
        from_secret: gcr_json_key
    commands:
      - apk add --update make curl bash git
      - docker ps -a
#      - echo $json_key | docker login https://asia.gcr.io -u _json_key --password-stdin
#      - make init
#      - make lint
#      - make packages/reinstall/shfmt
#      - make bash/fmt/check
#      - make docker/build
#      - make push

volumes:
  - name: dockersock
    host:
      path: /var/run/docker.sock
